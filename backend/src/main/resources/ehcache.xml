<?xml version="1.0" encoding="UTF-8"?>
<config xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
        xmlns='http://www.ehcache.org/v3'
        xsi:schemaLocation="http://www.ehcache.org/v3 http://www.ehcache.org/schema/ehcache-core-3.0.xsd">

    <!-- 
        Конфигурация L2 JPA Cache с Ehcache для Worker Management System
        
        Уровни хранения (tiering):
        - heap: хранение в Java heap памяти (самое быстрое, но ограничено)
        - offheap: хранение за пределами Java heap (медленнее, но не влияет на GC)
        - disk: постоянное хранение на диске (самое медленное, но persist между рестартами)
        
        Параметры:
        - time-to-live (TTL): время жизни записи в кэше
        - time-to-idle (TTI): время неактивности записи до её удаления
    -->

    <!-- Шаблон кэша по умолчанию для всех регионов -->
    <cache-template name="default-template">
        <!-- Время жизни записи: 1 час -->
        <expiry>
            <ttl unit="hours">1</ttl>
        </expiry>
        <resources>
            <!-- До 1000 объектов в heap памяти -->
            <heap unit="entries">1000</heap>
            <!-- До 10 MB в off-heap памяти -->
            <offheap unit="MB">10</offheap>
        </resources>
    </cache-template>

    <!-- Кэш для сущности Worker -->
    <cache alias="ru.itmo.is.lab1.entity.Worker" uses-template="default-template">
        <expiry>
            <ttl unit="minutes">30</ttl>
        </expiry>
        <resources>
            <heap unit="entries">500</heap>
            <offheap unit="MB">20</offheap>
        </resources>
    </cache>

    <!-- Кэш для сущности Organization -->
    <cache alias="ru.itmo.is.lab1.entity.Organization" uses-template="default-template">
        <expiry>
            <ttl unit="hours">2</ttl>
        </expiry>
        <resources>
            <heap unit="entries">200</heap>
            <offheap unit="MB">5</offheap>
        </resources>
    </cache>

    <!-- Кэш для сущности User -->
    <cache alias="ru.itmo.is.lab1.entity.User" uses-template="default-template">
        <expiry>
            <ttl unit="hours">1</ttl>
        </expiry>
        <resources>
            <heap unit="entries">100</heap>
            <offheap unit="MB">2</offheap>
        </resources>
    </cache>

    <!-- Кэш для сущности Person -->
    <cache alias="ru.itmo.is.lab1.entity.Person" uses-template="default-template">
        <expiry>
            <ttl unit="minutes">30</ttl>
        </expiry>
        <resources>
            <heap unit="entries">500</heap>
            <offheap unit="MB">10</offheap>
        </resources>
    </cache>

    <!-- Кэш для сущности Coordinates -->
    <cache alias="ru.itmo.is.lab1.entity.Coordinates" uses-template="default-template">
        <expiry>
            <ttl unit="minutes">30</ttl>
        </expiry>
        <resources>
            <heap unit="entries">500</heap>
            <offheap unit="MB">5</offheap>
        </resources>
    </cache>

    <!-- Кэш для сущности Location -->
    <cache alias="ru.itmo.is.lab1.entity.Location" uses-template="default-template">
        <expiry>
            <ttl unit="minutes">30</ttl>
        </expiry>
        <resources>
            <heap unit="entries">300</heap>
            <offheap unit="MB">5</offheap>
        </resources>
    </cache>

    <!-- Кэш для сущности Address -->
    <cache alias="ru.itmo.is.lab1.entity.Address" uses-template="default-template">
        <expiry>
            <ttl unit="minutes">30</ttl>
        </expiry>
        <resources>
            <heap unit="entries">200</heap>
            <offheap unit="MB">3</offheap>
        </resources>
    </cache>

    <!-- Кэш для сущности ImportHistory -->
    <cache alias="ru.itmo.is.lab1.entity.ImportHistory" uses-template="default-template">
        <expiry>
            <ttl unit="minutes">10</ttl>
        </expiry>
        <resources>
            <heap unit="entries">100</heap>
            <offheap unit="MB">2</offheap>
        </resources>
    </cache>

    <!-- Кэш для Query Cache (стандартные запросы) -->
    <cache alias="default-query-results-region" uses-template="default-template">
        <expiry>
            <ttl unit="minutes">5</ttl>
        </expiry>
        <resources>
            <heap unit="entries">200</heap>
            <offheap unit="MB">5</offheap>
        </resources>
    </cache>

    <!-- Кэш для Update Timestamps (синхронизация query cache) -->
    <cache alias="default-update-timestamps-region" uses-template="default-template">
        <expiry>
            <!-- Update timestamps не должны истекать -->
            <none/>
        </expiry>
        <resources>
            <heap unit="entries">5000</heap>
        </resources>
    </cache>

</config>

